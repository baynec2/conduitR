Bootstrap: docker
From: rocker/r-ver:4.4.3

%labels
    Maintainer: "Charlie Bayne <baynec2@gmail.com>"
    Version: "0.0.0.9000"
    Description: "R tools for metaproteomics analysis using conduit and conduit-GUI"

%post
    # Install system dependencies
    apt-get update -y && apt-get install -y --no-install-recommends \
        libcurl4-openssl-dev \
        libxml2-dev \
        libssl-dev \
        libfontconfig1-dev \
        libharfbuzz-dev \
        libfribidi-dev \
        fonts-dejavu \
        libbz2-dev \
        liblzma-dev \
        libzstd-dev \
        libglpk40 \
        git \
        libgit2-dev \
        curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

    # Install BiocManager and dependencies
    R -e "install.packages('BiocManager', repos='https://cloud.r-project.org')"

    # Install Bioconductor packages all at once
    R -e "BiocManager::install(c('QFeatures', 'SummarizedExperiment', 'limma', 'Biostrings', 'KEGGREST', 'impute', 'pcaMethods', 'sechm', 'PCAtools'))"

    # Optional: check Bioconductor install
    R -e "BiocManager::valid()"

    # Install remotes + conduitR
    R -e "install.packages('remotes', repos='https://cloud.r-project.org')"
    R -e "remotes::install_github('baynec2/conduitR')"

%environment
    export R_LIBS_USER=/usr/local/lib/R/site-library