Bootstrap: docker
From: ubuntu:22.04
Stage: spython-base

%labels
base_image="ubuntu:22.04"
version="2"
software="diann"
software.version="2.0"
about.summary="DIA-NN - a universal software for data-independent acquisition (DIA) proteomics data processing."
about.home="https://github.com/vdemichev/DiaNN"
about.documentation="https://github.com/vdemichev/DiaNN"
about.license_file="https://github.com/vdemichev/DiaNN/LICENSE.txt"
about.tags="Proteomics"
maintainer="Yasset Perez-Riverol <ypriverol@gmail.com>"
%post

# Some metadata

DEBIAN_FRONTEND=noninteractive

# Update package lists and ensure package versions are up to date, Install necessary packages
apt-get update && apt-get install -y --no-install-recommends \
wget \
unzip \
libgomp1 \
locales && \
rm -rf /var/lib/apt/lists/*

# Configure locale to avoid runtime errors
locale-gen en_US.UTF-8 && \
update-locale LANG=en_US.UTF-8

# Set environment variables for locale
LANG=en_US.UTF-8
LANGUAGE=en_US:en
LC_ALL=en_US.UTF-8

# Download and install DIA-NN
wget --no-check-certificate https://github.com/vdemichev/DiaNN/releases/download/2.0/DIA-NN-2.0.2-Academia-Linux.zip -O /tmp/DIA-NN-2.0.2-Academia-Linux.zip && \
unzip /tmp/DIA-NN-2.0.2-Academia-Linux.zip -d /usr/ && \
rm /tmp/DIA-NN-2.0.2-Academia-Linux.zip

# Remove unnecessary packages
apt-get remove -y wget unzip && apt-get autoremove -y && apt-get clean && \
rm -rf /var/lib/apt/lists/*

# Set appropriate permissions for the DIA-NN folder
chmod +x /usr/diann-2.0.2/diann-linux

# Create a symbolic link and add to PATH
ln -s /usr/diann-2.0.2/diann-linux /usr/diann-2.0.2/diann
PATH="$PATH:/usr/diann-2.0.2"

mkdir -p /data/
cd /data/

# NOTE: It is entirely the user's responsibility to ensure compliance with DIA-NN license terms.
# Please review the licensing terms for DIA-NN before using or distributing this Docker image.
%environment
export DEBIAN_FRONTEND=noninteractive
export LANG=en_US.UTF-8
export LANGUAGE=en_US:en
export LC_ALL=en_US.UTF-8
export PATH="$PATH:/usr/diann-2.0.2"
%runscript
cd /data/
exec /bin/bash "$@"
%startscript
cd /data/
exec /bin/bash "$@"
