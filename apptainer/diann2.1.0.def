Bootstrap: docker
From: ubuntu:22.04

%labels
    base_image ubuntu:22.04
    version 2
    software diann
    software.version 2.1.0
    about.summary "DIA-NN - a universal software for data-independent acquisition (DIA) proteomics data processing."
    about.home https://github.com/vdemichev/DiaNN
    about.documentation https://github.com/vdemichev/DiaNN
    about.license_file https://github.com/vdemichev/DiaNN/LICENSE.txt
    about.tags Proteomics
    maintainer Yasset Perez-Riverol <ypriverol@gmail.com>

%environment
    export DEBIAN_FRONTEND=noninteractive
    export LANG=en_US.UTF-8
    export LANGUAGE=en_US:en
    export LC_ALL=en_US.UTF-8
    export PATH="/usr/diann-2.1.0:$PATH"

%post
    echo "Updating packages and installing dependencies..."
    apt-get update && apt-get install -y --no-install-recommends \
        wget \
        unzip \
        libgomp1 \
        locales && \
        rm -rf /var/lib/apt/lists/*
    
    apt-get update && apt-get install -y ca-certificates wget gnupg
    update-ca-certificates


    # Install Microsoft package repository and .NET SDK 8.0
    wget https://packages.microsoft.com/config/ubuntu/22.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
    dpkg -i packages-microsoft-prod.deb
    rm packages-microsoft-prod.deb
    apt-get update
    apt-get install -y dotnet-sdk-8.0
    echo "Configuring locale..."
    locale-gen en_US.UTF-8 && \
    update-locale LANG=en_US.UTF-8

    echo "Downloading and installing DIA-NN..."
    wget --no-check-certificate https://github.com/vdemichev/DiaNN/releases/download/2.0/DIA-NN-2.1.0-Academia-Linux.zip
    unzip DIA-NN-2.1.0-Academia-Linux.zip -d /usr/
    rm DIA-NN-2.1.0-Academia-Linux.zip

    echo "Cleaning up..."
    apt-get remove -y wget unzip && apt-get autoremove -y && apt-get clean && \
    rm -rf /var/lib/apt/lists/*

    echo "Setting permissions and symlinks..."
    chmod +x /usr/diann-2.1.0/diann-linux
    ln -s /usr/diann-2.1.0/diann-linux /usr/diann-2.1.0/diann

%runscript
    echo "Welcome to the DIA-NN container!"
    exec diann "$@"

%startscript
    echo "Starting DIA-NN container..."
    exec diann "$@"

%help
    This container includes DIA-NN v2.1.0 for processing DIA proteomics data.
    Homepage: https://github.com/vdemichev/DiaNN
    License: https://github.com/vdemichev/DiaNN/LICENSE.txt
    Usage: diann [options]
